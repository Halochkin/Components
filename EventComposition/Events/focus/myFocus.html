<script src="../../1b_EventLoop/demo/toggleTick.js"></script>
<script>
  const og = HTMLElement.prototype.attachShadow;
  Object.defineProperty(HTMLElement.prototype, "attachShadow", {
    value: function (options) {
      const shadow = og.call(this, options);
      if (options === undefined || options.mode === "closed")
        this._closedShadowRoot = shadow;
      return shadow;
    }
  });

</script>
<style>
    div {
        border: 10px solid red;
    }
</style>

<div id="one" tabindex="1">one</div>
<web-comp><a href="#lala">Hello sunshine</a></web-comp>
<div id="two" tabindex="2">two</div>

<!--<HR>-->
<!--<web-comp id="two" tabindex="3"></web-comp>-->

<script>
  //bouncing dblclick
  (function () {

      let activeTarget = null;

      let activeElements = []; //set last active element root nodes, (  let root = e.target.getRootNode();)

      function bouncingKeydownController(e) {

        if (e.key !== "Tab") {
          return;
        }

        //find all active roots of the active target which is old, that is different from active root in the new active target (iterator, host node) check if are the same

        let root = e.target.getRootNode();

        // let allRoots = // get all roots and pass into the root as an argument (github)

        // find all existing elements which are not a part of the root, and then use it as a target to dispatch blur and focusout / remove pseudo-classes etc.
        if (activeElements.indexOf(root) !== -1) {
          //remove
          //dispatch blur event
        }
      }
    }


  )();

  // addBouncingMousedownController(window);

  addBouncingKeydownController(window);


  // window.addEventListener("my-focus", e => console.warn(e.type, e.target), true);
  // window.addEventListener("my-focusin", e => console.warn(e.type, e.target), true);
  // window.addEventListener("my-blur", e => console.warn(e.type, e.target), true);
  // window.addEventListener("my-focusout", e => console.warn(e.type, e.target), true);
  //
  // window.addEventListener("focus", e => console.log(e.type, e.target), true);
  // window.addEventListener("focusin", e => console.log(e.type, e.target), true);
  // window.addEventListener("focusout", e => console.log(e.type, e.target), true);
  // window.addEventListener("blur", e => console.log(e.type, e.target), true);


  class WebComp extends HTMLElement {
    constructor() {
      super();
      const shadow = this.attachShadow({mode: "closed"});
      // addBouncingMousedownController(shadow);
      addBouncingKeydownController(shadow);
      shadow.innerHTML = `
        <style>
        div{
            height: 30px;
            width: 100px;
            border: 1px solid gray;
         }
         div[my-focus]{
           background-color: khaki;
         }
        </style>
        <div tabindex="3">three
          <slot></slot>
        </div>
        <div tabindex="4">four</div>

`;

      // shadow.addEventListener("my-focus", e => console.warn("shadow|   ", e.type, e.target), true);
      // shadow.addEventListener("my-focusin", e => console.warn("shadow|   ", e.type, e.target), true);
      // shadow.addEventListener("my-blur", e => console.warn("shadow|   ", e.type, e.target), true);
      // shadow.addEventListener("my-focusout", e => console.warn("shadow|   ", e.type, e.target), true);
      //
      // shadow.addEventListener("focusin", e => console.log("shadow|   ", e.type, e.target), true);
      // shadow.addEventListener("focus", e => console.log("shadow|   ", e.type, e.target), true);
      // shadow.addEventListener("focusout", e => console.log("shadow|   ", e.type, e.target), true);
      // shadow.addEventListener("blur", e => console.log("shadow|   ", e.type, e.target), true);
    }
  }

  customElements.define("web-comp", WebComp);

</script>


