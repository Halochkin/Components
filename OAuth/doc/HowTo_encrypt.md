# HowTo: Encrypt data  //todo fix it 
 Encrypt state using `AES-GCM` cypher. To encrypt data `getEncryptedData()` is use.
### HowTo encrypt data.
```javascript
async function getEncryptedData(data) {          
    const iv = crypto.getRandomValues(new Uint8Array(12)); 
    const cipher = await encryptAESGCM(SECRET, iv, data);
    return uint8ToHexString(iv) + '.' + toBase64url(btoa(cipher));
}
```
 The function accepts data to be encrypted. To encrypt the data with AESGCM cipher, you need to create Uint8Array initialization vector (iv). `iv` â€” A random or pseudo-random sequence of characters that is added to an encryption key to improve its security. Must be unique every encryption operation carried out with a given key. Put way: never reuse an IV with the same key. Don't re-use initialization vectors. It is necessary to generate a new iv every time your encrypt. Recommended to use 12 bytes length. Initialization vector does not require encryption and is usually transmitted together with the cryptographic key. So result of function execution will be a string which contain iv and encrypted data divided by `.`.
 To encrypt data use:
  * `SECRET` (secret key which we define as global variable)
  * `iv`
  * `data` data to be encrypted.
   
```javascript
let cachedPassHash;

async function passHash(pw) {
    return cachedPassHash || (cachedPassHash = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(pw)));
}

async function makeKeyAESGCM(password, iv) {
    const pwHash = await passHash(password);    //small value generated by a hash function from a whole message
    const alg = { name: 'AES-GCM', iv: iv };    // specify algorithm to use
    return await crypto.subtle.importKey('raw', pwHash, alg, false, ['decrypt', 'encrypt']);  // use pw to generate key
}

async function encryptAESGCM(password, iv, plaintext) {
    const key = await makeKeyAESGCM(password, iv);            //crypto key
    const ptUint8 = new TextEncoder().encode(plaintext);     // encode plaintext as UTF-8
    const ctBuffer = await crypto.subtle.encrypt({ name: key.algorithm.name, iv: iv }, key, ptUint8);// encrypt plaintext using key
    const ctArray = Array.from(new Uint8Array(ctBuffer));     // ciphertext as byte array
    return ctArray.map(byte => String.fromCharCode(byte)).join('');   // ciphertext as string
}
```