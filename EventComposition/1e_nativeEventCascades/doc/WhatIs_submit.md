# What is `submit` ?

The submit event fires when a `<form>` is submitted. It is usually used to check (validate) the form before it is submitted to the server or to prevent it from being sent and processed using JavaScript.

There are 3 ways to submit a form:

1. Press the `<input type="submit">`, `<input type="image">` or `<button type="submit"> Submit </button>` element;
    #### Example
    
     ```html
      <form>
        <input type="text" value="I didn't say it would be easy. I just promised to tell the truth.">
      
        <input type="submit">
        <input type="image" src="https://via.placeholder.com/150" width="50">
        <button type="submit"> Submit </button>   
      </form>
   
      <script>
       window.addEventListener("submit", e => {
        e.preventDefault();
        console.log("Wait, how about a cup of tea?");
       });
      </script>
     ```
   
2. Press `Enter` key when input field has active focus.
Sending a form by pressing the `Enter` key in a text field with active focus generates a `click` event on the top submit button in the DOM.
    
    There are several features to use the `Enter` key to submit a form:
    1. If there are several submit buttons - `click` event will be generate on first button in the DOM tree order;
       #### Example
          ```html
          <form>
            <input type="text" value="Press Enter key">
            <input type="submit">  
            <button type="submit">Submit</button>
          </form>
          
          <script>
            let one = document.querySelector("input[type=submit]");
            let two = document.querySelector("button");
          
            function log(e) {
              console.log(e.type, " event on ", e.target.tagName);
            }
          
            one.addEventListener("click", e => log(e)); //generated by Enter key
            two.addEventListener("click", e => log(e)); // no click
            window.addEventListener("submit", e => log(e));
          </script>
         ```
   
    2. If there is one event `<input>` - `submit` event will fire, whether or not there is a submit button.
       #### Example
            ```html
               <form>
                   <input type="text" value="Press Enter key">
               </form>
               
               <script>
                 function log(e) {
                   console.log(e.type, " event on ", e.target.tagName);
                 }
       
                 window.addEventListener("submit", e => log(e)); //will be activated
                 window.addEventListener("click", e => log(e));  //not fires
               </script>
            ```    
    3. If there are several `<input>`s and there is no submit button - `submit` event will **not** fire.
       #### Example
       ```html
       <form>
           <input type="text" value="Press Enter key">
           <input type="text" value="Press Enter key here too">
       </form>
       
       <script>
         function log(e) {
           console.log(e.type, " event on ", e.target.tagName);
         }
       
         window.addEventListener("submit", e => log(e)); //not fire
       </script>
       ```    

3. Call `.submit()/.requestSubmit()` on `<form>` element.
   To submit form manually, it is possible to call either `.submit()` or `.requestSubmit()` methods. Both methods are similar, but there's a difference:
   
   1. `.submit()` - submits form but `submit` event is not fires. It is assumed that if the programmer calls `form.submit()`, then the script already did all related processing. This method does not provide form validation.
       
 This means that the browser does not guarantee that the data entered in the field with a certain type of data meets the requirements. For example, if the user set text value into `<input type="number">` and tries to send a form. 
 
   > Since the verification is performed only when the first two methods are used - trying to submit a form that does not pass validation triggers an invalid event. In this case, the validation prevents form submission, and thus there is no submit event.
 
 2.  `.requestSubmit()` guarantees to the browser that the entered data will be verified and in case of entering incorrect data the user will be warned about an error and the form will not be able to be sent until all data are entered correctly. Once the form is submitted, the `submit` event is fire on `<form>` element.
 
 To see the difference, consider a small example
   #### Example
    
   ```html
 <form>
     <input type="number" size="300" placeholder="try to set e character and submit form"/>
     <input type="submit">
     <div id="one"> submit()</div>
     <div id="two"> requestSubmit()</div>
 </form>
 
 <script>
   document.querySelector("#one").addEventListener("click", e => e.target.parentNode.submit());
   document.querySelector("#two").addEventListener("click", e => e.target.parentNode.requestSubmit());
 
   window.addEventListener("submit", e => {
     e.preventDefault();
     console.log("submit event has been initiated by: #", e.target.id); 
   });
 </script>
   ```

 ### Demo: SubmitController
In the demo below a function `SubmitController` essentially recreates the logic of the `submit` event cascade and defines its own `my-submit` event. 
 
The demo:

1. Adds a function `toggleTick` that allows to delay event dispatching;
2. Completely blocks all the native `'submit'` events. 
3. Then it adds a function `SubmitController` that listens for `beforeinput`,`click` events and intercepts `requestSubmit()` calling;
4. Once the `ResetController` receives an appropriate trigger event, it:
    1. When the `"beforeinput"` event is activated, the `Enter` button is filtered out.  
        1. After it is pressed, the default action is blocked. This is necessary to avoid `click()`  on the submit button, which is initialized by the browser;
        2. The specification defines the features of activating the event by pressing a key. If the number of `<input>` elements differs, the behavior will be different. So it is necessary to determine their number and then depending on the result of the event and do the default actions;
        3. Delay the sending of the event to make it possible to cancel it.
    2. If the `click` event is activated, the value of `type` attribute of event target will be checked. This is necessary in order to ensure the activation of the functionality only by means of the `submit` buttons.
    3. If 'requestSubmit()` is reconciled, it will be intercepted and processed. 
        1. In accordance with the [spec](https://html.spec.whatwg.org/multipage/forms.html#dom-form-requestsubmit), it is checked for errors;
        2. In addition, depending on the value of the passed argument, the [`submitter`](https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#the-submitevent-interface) property is added to the event.
5. Demo presents two forms. The first simulates the activation of `submit` event. 
   The second one demonstrates the prevention of activation with `e.preventDefault()` placed inside event listener of the custom `my-submit` event.         
    
 ```html
    <form id="one">
        <fieldset>
            <legend>Click "Submit" button or press Enter</legend>
            <input type="text" value="Hello" name="story">
            <input type="text" value="Sunshine" name="story">
            <input id="a" type="submit">
            <div id="b"> requestSubmit(button)</div>
            <div  id="c"> requestSubmit()</div>
        </fieldset>
    </form>
    
    <form id="two">
        <fieldset>
            <legend>Click the "Submit" button, but it will be prevent</legend>
            <input type="text" value="Name" name="story">
            <input type="text" value="Surname" name="story">
            <input id="a1" type="submit">
            <div  id="b1"> requestSubmit(button)</div>
            <div  id="c1"> requestSubmit()</div>
        </fieldset>
    </form>
    
    <script>
    
      (function () {
        function toggleTick(cb) {
          const details = document.createElement("details");
          details.style.display = "none";
          details.ontoggle = cb;
          document.body.appendChild(details);
          details.open = true;
          Promise.resolve().then(details.remove.bind(details));
          return {
            cancel: function () {
              details.ontoggle = undefined;
            },
            resume: function () {
              details.ontoggle = cb;
            }
          };
        }
    
        const SubmitController = {
    
          beforeinput: function (e) {
            let formElement = e.target.form;
            // we can use only Enter key
            if (e.inputType !== "insertLineBreak" || !formElement)
              return;
            // to prevent default click() after Enter key press
            e.preventDefault();
            // check how many input elements (not reset/submit type) are located in the form
            let inputs = formElement.querySelectorAll("input:not([type=reset]):not([type=submit])").length;
            // select first submit button (default button according to spec)
            let firstSubmitButton = formElement.querySelector("input[type=submit]");

            let submitEvent = new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true});
    
            // According to spec(https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#implicit-submission)
            // 1. if one or several <input>s and one or several submit buttons are located on the <form> - .click() on default button to submit a form
            if (inputs >= 1 && firstSubmitButton)
              firstSubmitButton.click();
            //2. if there is only one <input> element  - fire 'submit' event on <form> (even if there is no any submit button)
            else if (inputs === 1) {
              // delay event to make it possible to prevent it
              toggleTick(() => {
                formElement.dispatchEvent(submitEvent);
                if (submitEvent.defaultPrevented) {
                  clearTimeout(i);
                  console.log("defaultPrevented ");
                }
              });
              //fires after toggleClick to provide default action prevention
              let i = setTimeout(() => {
                console.log("do default action here");
              }, 0);
            }
          },
    
          click: function (e) {
            let formElement = e.target.form;
            if (e.target.type && e.target.type !== "submit" || !formElement)
              return;
    
            let submitEvent = new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true});
    
            toggleTick(() => {
              formElement.dispatchEvent(submitEvent);
              if (submitEvent.defaultPrevented) {
                clearTimeout(i);
                console.log("defaultPrevented ");
              }
            });
    
            let i = setTimeout(() => {
              console.log("do default action here");
            }, 0);
          },
    
          requestSubmit: function (submitButton) {
           
            //Set errors according to  https://html.spec.whatwg.org/multipage/forms.html#dom-form-requestsubmit
            if (submitButton && submitButton.type !== "submit")
               throw new Error("TypeError: " + submitButton.type + "type is not submit");
            if (submitButton && submitButton.form !== this)
              throw new Error("NotFoundError: " + this.tagName + " not a FORM");
            
            let submitEvent = new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true});

            if (submitButton !== null)
              submitEvent.submitter = submitButton;
    
            toggleTick(() => {
              this.dispatchEvent(submitEvent);
              if (submitEvent.defaultPrevented) {
                clearTimeout(i);
                console.log("defaultPrevented ");
              }
            });
    
            let i = setTimeout(() => {
              console.log("do default action here");
            }, 0);
          }
        };
    
        window.addEventListener("submit", e => e.preventDefault());
        window.addEventListener("beforeinput", SubmitController.beforeinput.bind(this), true);
        window.addEventListener("click", SubmitController.click, true);
        HTMLFormElement.prototype.requestSubmit = function (submitter) {
          SubmitController.requestSubmit.call(this, submitter)
        };
    
      })();
      
      let one = document.querySelector("#one");
      let two = document.querySelector("#two");
      let button = document.querySelector("#a");
      let button1 = document.querySelector("#a1");
    
      //form 1, must log "do default action here"
      document.querySelector("#b").addEventListener("click", () => one.requestSubmit(button));
      document.querySelector("#c").addEventListener("click", () => one.requestSubmit());
    
      //form 2 preventable, must log "defaultPrevented"
      document.querySelector("#b1").addEventListener("click", () => two.requestSubmit(button1));
      document.querySelector("#c1").addEventListener("click", () => two.requestSubmit());
    
      one.addEventListener("my-submit", e => console.warn(e.type));
      two.addEventListener("my-submit", e => console.warn(e.type));
      two.addEventListener("my-submit", e => e.preventDefault());
    
      window.addEventListener("click", e => console.log(e.type, " on ", e.target.id))
    
    </script>
 ```

#### References

1. [MDN: `submit` event](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit_event);
2. [MDN: `.submit()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/submit);
3. [MDN: `.requestSubmit()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/requestSubmit);
4. [`submitter` event property](https://www.chromestatus.com/feature/5187248926490624)








