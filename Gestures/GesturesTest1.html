<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo</title>
    <style>
        test-block {
            height: 250px;
            width: 250px;
            background-color: red;
            display: block;
            text-align: center;
            line-height: 15;
            color: white;
        }

        switch-button {
            position: fixed;
            display: inline-flex;
            margin: 100px;
            margin-left: 211px;
        }

    </style>
</head>
<body>
<div id="viewport">
    <test-block id="controller"></test-block>
</div>
<switch-button id="buttons"></switch-button>

<script type="module">

  import {DragFlingGesture} from "https://rawgit.com/Halochkin/Components/master/Gestures/DragFlingMixin/src/DragFlingGestureMixin.js";
  import {PinchGesture} from "https://rawgit.com/Halochkin/Components/master/Gestures/PinchGestureMixin/src/PinchMixin.js";
  import {SwipeGesture} from "https://rawgit.com/Halochkin/Components/master/Gestures/SwipeGestureMixin/src/SwipeGesture.js";
  import {simulateEventSequence} from "https://rawgit.com/Halochkin/Components/master/Gestures/EventSimulator/src/EventSimulator.js";

 class TestBlock extends SwipeGesture(DragFlingGesture(PinchGesture(HTMLElement))) {

    constructor() {
      super();
      this._onPinchListener = e => this.onPinch(e);
      this._onSpinListener = e => this.onSpin(e);
      this._switcherListener = e => this.onSwitch(e);
      this._dragListener = e => this.onDrag(e);
      this._flingListener = e => this.onFling(e);
      this.lastListener = [""];
    }

    static get pinchEvent() {
      return true;
    }

    static get dragEvent() {
      return true;
    }

    connectedCallback() {
      super.connectedCallback();
      this.style.marginTop = "250px";
      this.style.marginLeft = "200px";
      document.getElementById("buttons").addEventListener("buttons-select", this._switcherListener);
    }

    onSwitch(event) {
      const myElement = document.getElementById('controller');
      if (event.detail === "pinch") {
        this.addEventListener("pinch", this._onPinchListener);
        this.lastListener.push([event.detail, this._onPinchListener]);
        simulateEventSequence([
          [myElement, "start", 1],
          [myElement, "start", 2],
          [myElement, "move", 2],
          [myElement, "end", 2]
        ]);
        this.removeEventListener(this.lastListener[this.lastListener.length - 1][0], this.lastListener[this.lastListener.length - 1][1]);
      }

      if (event.detail === "spin") {
        this.addEventListener("spin", this._onSpinListener);
        this.lastListener.push([event.detail, this._onSpinListener]);
        simulateEventSequence([
          [myElement, "start", 1],
          [myElement, "start", 2],
          [myElement, "move", 2]
        ]);
        setTimeout(function () {
          simulateEventSequence([[myElement, "end", 2]])
        }, 120);
      }

      if (event.detail === "dragging") {
        this.addEventListener("dragging", this._dragListener);
        this.lastListener.push([event.detail, this._dragListener]);
        simulateEventSequence([
          [myElement, "start", 1],
          [myElement, "move", 1],
          [myElement, "end", 1]
        ]);
        this.removeEventListener(this.lastListener[this.lastListener.length - 1][0], this.lastListener[this.lastListener.length - 1][1]);
      }

      if (event.detail === "fling") {
        this.addEventListener("fling", this._flingListener);
        this.lastListener.push([event.detail, this._flingListener]);
        simulateEventSequence([[myElement, "start", 1],
          setTimeout(function () {
            simulateEventSequence([[myElement, "move", 1]])
          }, 100)]);
        setTimeout(function () {
          simulateEventSequence([[myElement, "end", 1]])
        }, 220);
        this.removeEventListener(this.lastListener[this.lastListener.length - 2][0], this.lastListener[this.lastListener.length - 2][1]);
      }

      if (event.detail === "swipe") {
        this.addEventListener("swipeend", this._swipeListener);
        this.lastListener.push([event.detail, this._swipeListener]);
        simulateEventSequence([
          [myElement, "start", 2],
          [myElement, "move", 2],
          [myElement, "end", 2]
        ]);
        this.removeEventListener(this.lastListener[this.lastListener.length - 1][0], this.lastListener[this.lastListener.length - 1][1]);
      }
    }

    onPinch(e) {
      this.style.transition = "2s";
      let prevSpinAngle = (this.style.transform ? parseFloat(this.style.transform.substring(7)) : 0);
      this.style.transform = `rotate(${prevSpinAngle + e.detail.rotation}deg)`;
      this.innerText = "PINCH";
    }

    onSpin(e) {
      this.style.transition = "1s";
      let prevSpinAngle = (this.style.transform ? parseFloat(this.style.transform.substring(7)) : 0);
      this.style.transform = `rotate(${prevSpinAngle + e.detail.rotation * 5}deg)`;
      this.innerText = "SPIN";
    }

    onDrag(e) {
      this.style.transition = "0.7s";
      this.style.borderRadius = "10%";
      this.style.marginTop = (parseFloat(this.style.marginTop) + e.detail.distY) + "px";
      this.style.marginLeft = (parseFloat(this.style.marginLeft) + e.detail.distX) + "px";
      this.innerText = "DRAG";
    }

    onFling(e) {
      this.style.transition = "all 1s cubic-bezier(0.39, 0.58, 0.57, 1)";
      this.style.marginTop = (parseFloat(this.style.marginTop) + e.detail.distY * 2) + "px";
      this.style.marginLeft = (parseFloat(this.style.marginLeft) + e.detail.distX * 2) + "px";
      this.innerText = "FLING";
    }
  }

  class SwitchButtons extends PinchGesture(HTMLElement) {
    constructor() {
      super();
      this.innerHTML = `
    <input type="radio" id="pinch" name="check" ><label>Pinch</label>
    <input type="radio" id="spin" name="check" ><label>Spin</label>
    <input type="radio" id="dragging" name="check"><label>Drag</label><br>
    <input type="radio" id="fling" name="check"><label>Fling</label>`;
      this.addEventListener("click", e => {
        this.dispatchEvent(new CustomEvent("buttons-select", {composed: true, bubbles: true, detail: e.target.id}));
      });
    }
  }

  customElements.define("test-block", TestBlock);
  customElements.define("switch-button", SwitchButtons);

</script>
</body>
</html>
