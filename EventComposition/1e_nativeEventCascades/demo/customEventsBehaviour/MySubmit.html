<form name="one" id="one">
    <fieldset>
        <legend>Click "Submit" button or press Enter</legend>
        <input type="text" value="Hello" name="story">
        <input type="text" value="Sunshine" name="story">
        <input id="a" type="submit">
        <div id="b"> requestSubmit(button)</div>
        <div id="c"> requestSubmit()</div>
    </fieldset>
</form>

<form id="two">
    <fieldset>
        <legend>Click the "Submit" button, but it will be prevent</legend>
        <input type="text" value="Name" name="story">
        <input type="text" value="Surname" name="story">
        <input id="a1" type="submit">
        <div id="b1"> requestSubmit(button)</div>
        <div id="c1"> requestSubmit()</div>
    </fieldset>
</form>

<script>

  (function () {
    function toggleTick(cb) {
      const details = document.createElement("details");
      details.style.display = "none";
      details.ontoggle = cb;
      document.body.appendChild(details);
      details.open = true;
      Promise.resolve().then(details.remove.bind(details));
      return {
        cancel: function () {
          details.ontoggle = undefined;
        },
        resume: function () {
          details.ontoggle = cb;
        }
      };
    }

    const SubmitController = {

      beforeinput: function (e) {
        let formElement = e.target.form;
        // we can use only Enter key
        if (e.inputType !== "insertLineBreak" || !formElement)
          return;
        // to prevent default click() after Enter key press
        e.preventDefault();
        // check how many input elements (not reset/submit type) are located in the form
        let inputs = formElement.querySelectorAll("input:not([type=reset]):not([type=submit])").length;
        // select first submit button (default button according to spec)
        let firstSubmitButton = formElement.querySelector("input[type=submit]");
        let submitEvent = new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true});

        // According to spec(https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#implicit-submission)
        // 1. if one or several <input>s and one or several submit buttons are located on the <form> - .click() on default button to submit a form
        if (inputs >= 1 && firstSubmitButton)
          firstSubmitButton.click();
        //2. if there is only one <input> element  - fire 'submit' event on <form> (even if there is no any submit button)
        else if (inputs === 1) {
          // delay event to make it possible to prevent it
          toggleTick(() => {
            formElement.dispatchEvent(submitEvent);
            if (submitEvent.defaultPrevented) {
              clearTimeout(i);
              console.log("defaultPrevented ");
            }
          });
          //fires after toggleClick to provide default action prevention
          let i = setTimeout(() => {
            console.log("do default action here");
          }, 0);
        }
      },

      click: function (e) {
        let formElement = e.target.form;
        if (e.target.type && e.target.type !== "submit" || !formElement)
          return;

        let submitEvent = new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true});

        toggleTick(() => {
          formElement.dispatchEvent(submitEvent);
          if (submitEvent.defaultPrevented) {
            clearTimeout(i);
            console.log("defaultPrevented ");
          }
        });

        let i = setTimeout(() => {
          console.log("do default action here");
        }, 0);
      },

      requestSubmit: function (submitButton) {
        let submitEvent = new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true});
        //according to  https://html.spec.whatwg.org/multipage/forms.html#dom-form-requestsubmit
        if (submitButton && submitButton.type !== "submit")
          throw new Error("TypeError: " + submitButton.type + "type is not submit");
        if (submitButton && submitButton.form !== this)
          throw new Error("NotFoundError: " + this.tagName + " not a FORM");
        // according to https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#the-submitevent-interface
        // and
        // https://www.chromestatus.com/feature/5187248926490624
        // if there is submit button, we need to set submitter attribute to event
        if (submitButton)
          submitEvent.submitter = submitButton;

        toggleTick(() => {
          this.dispatchEvent(submitEvent);
          if (submitEvent.defaultPrevented) {
            clearTimeout(i);
            console.log("defaultPrevented ");
          }
        });

        let i = setTimeout(() => {
          console.log("do default action here");
        }, 0);
      }
    };

    window.addEventListener("beforeinput", SubmitController.beforeinput.bind(this), true);
    window.addEventListener("click", SubmitController.click, true);

    HTMLFormElement.prototype.requestSubmit = function (submitter) {
      SubmitController.requestSubmit.call(this, submitter)
    };

    window.addEventListener("submit", e => e.preventDefault());
    // window.addEventListener("beforeinput", e => e.preventDefault());
  })();

  let one = document.querySelector("#one");
  let two = document.querySelector("#two");
  let button = document.querySelector("#a");
  let button1 = document.querySelector("#a1");

  //form 1, must log "do default action here"
  document.querySelector("#b").addEventListener("click", () => one.requestSubmit(button));
  document.querySelector("#c").addEventListener("click", () => one.requestSubmit());

  //form 2 preventable, must log "defaultPrevented"
  document.querySelector("#b1").addEventListener("click", () => two.requestSubmit(button1));
  document.querySelector("#c1").addEventListener("click", () => two.requestSubmit());

  one.addEventListener("my-submit", e => console.warn(e.type));
  two.addEventListener("my-submit", e => console.warn(e.type));
  two.addEventListener("my-submit", e => e.preventDefault());

  window.addEventListener("click", e => console.log(e.type, " on ", e.target.id))

</script>
