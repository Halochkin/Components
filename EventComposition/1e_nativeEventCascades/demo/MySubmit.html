<form name="one" id="one">
    <fieldset>
        <legend>Click "Submit" button or press Enter</legend>
        <input type="text" value="Tell us your story" name="story">
        <input type="text" value="Tell us your story" name="story">
        <br>
        <input id="a" type="submit">
        <!--        set custom attribute-->
        <div type="submit" id="b"> requestSubmit(button)</div>
        <div type="submit" id="c"> requestSubmit()</div>
    </fieldset>
</form>

<form id="two">
    <fieldset>
        <legend>Click the "Submit" button, but it will not help).</legend>
        <input type="text" value="Tell us your story" name="story">
        <input type="text" value="Tell us your story" name="story">
        <br>
        <input id="a1" type="submit">
        <!--        set custom attribute-->
        <div type="submit" id="b1"> requestSubmit(button)</div>
        <div type="submit" id="c1"> requestSubmit()</div>
    </fieldset>
</form>

<script>


  (function () {
    function toggleTick(cb) {
      const details = document.createElement("details");
      details.style.display = "none";
      details.ontoggle = cb;
      document.body.appendChild(details);
      details.open = true;
      Promise.resolve().then(details.remove.bind(details));
      return {
        cancel: function () {
          details.ontoggle = undefined;
        },
        resume: function () {
          details.ontoggle = cb;
        }
      };
    }

    const SubmitController = {
      state: new WeakMap(),
      submitEvent: new InputEvent("my-submit", {composed: true, bubbles: true, cancelable: true}),


      beforeinput: function (e) {
        // here we handle Enter key press submitting
        let formElement = e.target.form;

        // we can use only Enter key
        if (e.inputType !== "insertLineBreak" || !formElement)
          return;

        // check how many allowed input elements (not type=reset/submit) are located in the form
        let inputs = formElement.querySelectorAll("input:not([type=reset]):not([type=submit])").length;
        // select first submit button (default button according to spec)
        let firstSubmitButton = formElement.querySelector("input[type=submit]");

        // According to spec(https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#implicit-submission)
        // 1. if 1 or several inputs and one or several submit buttons - click() on first one (default button) and then submit
        if (inputs >= 1 && firstSubmitButton)
          firstSubmitButton.click(); //click: will handle it
        //2. if only 1 input  - fire submit event on <form> (even without submit button)
        else if (inputs === 1) {
          // delay event to make it possible to prevent it
          toggleTick(() => {
            formElement.dispatchEvent(SubmitController.submitEvent);
            if (SubmitController.submitEvent.defaultPrevented) {
              clearTimeout(i);
              console.log("defaultPrevented ");
            }
          });
          //fires after toggleClick to provide default action preventation
          let i = setTimeout(() => {
            console.log("do default action here");
          }, 0);
        }
      },

      click: function (e) {
        let formElement = e.target.form;
        let val = e.target.getAttribute("type");
        if (e.target.type && e.target.type !== "submit" || val !== "submit" || !formElement)
          return;

        toggleTick(() => {
          formElement.dispatchEvent(SubmitController.submitEvent);
          if (SubmitController.submitEvent.defaultPrevented) {
            clearTimeout(i);
            console.log("defaultPrevented ");
          }
        });

        let i = setTimeout(() => {
          console.log("do default action here");
        }, 0);
      },

      requestSubmit: function (submitButton) {

        // some browsers can not support .requestSubmit()
        toggleTick(() => {
          this.dispatchEvent(SubmitController.submitEvent);
          if (SubmitController.submitEvent.defaultPrevented) {
            clearTimeout(i);
            console.log("defaultPrevented ");
          }
        });

        let i = setTimeout(() => {
          console.log("do default action here");
        }, 0);
      }
    };

    // we can fire submit event using Enter key or click on the submit button , but we have several conditions defined in spec
    window.addEventListener("beforeinput", SubmitController.beforeinput.bind(this), true);
    // window.addEventListener("focusin", SubmitController.focusin, true);
    window.addEventListener("click", SubmitController.click, true);
    //no event, because it can be called programmatically and not based on event.
    // not use arrow function here, because this keyword refers to window object
    HTMLFormElement.prototype.requestSubmit = function (submitter) {
      SubmitController.requestSubmit.call(this)
    };
  })();


  window.addEventListener("submit", e => e.preventDefault());
  // we need to block "beforeinput" event because by default it provides .click on submit button by default. We already have such custom click and we dont need 2 clicks;
  window.addEventListener("beforeinput", e => e.preventDefault());


  let one = document.querySelector("#one");
  let two = document.querySelector("#two");

  let button = document.querySelector("#a");
  let button1 = document.querySelector("#a1");

  //form 1, must log "do default action here"
  document.querySelector("#b").addEventListener("click", () => one.requestSubmit(button));
  document.querySelector("#c").addEventListener("click", () => one.requestSubmit());

  //form 2 preventable, must log "defaultPrevented"
  document.querySelector("#b1").addEventListener("click", () => two.requestSubmit(button1));
  document.querySelector("#c1").addEventListener("click", () => two.requestSubmit());

  one.addEventListener("my-submit", e => console.warn(e.type));
  two.addEventListener("my-submit", e => console.warn(e.type));
  two.addEventListener("my-submit", e => e.preventDefault());


  window.addEventListener("click", e => console.log(e.type, " on ", e.target.id))

</script>


<!--

1. A form element's default button is the first submit button in tree order whose form owner is that form element.

2. If the user agent supports letting the user submit a form implicitly (for example, on some platforms hitting the "enter" key while a text control is focused implicitly submits the form), then doing so for a form, whose default button has activation behavior and is not disabled, must cause the user agent to fire a click event at that default button.

3. If the form has no submit button, then the implicit submission mechanism must do nothing if the form has more than one field that blocks implicit submission, and must submit the form element from the form element itself otherwise.


1. When a form is submitted, the data in the form is converted into the structure specified by the enctype, and then sent to the destination specified by the action using the given method.
2. If the user types in "cats" in the first field and "fur" in the second, and then hits the submit button, then the user agent will load /find.cgi?t=cats&q=fur


// discussion

https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/requestSubmit

-->