<style>
    #outer {
        height: 500px;
        width: 500px;
        background-color: yellow;
    }

    .pseudo_my_mouseenter {
        border: 2px solid green;
    }

    .pseudo_my_mouseleave {
        border: 2px solid red;
    }

    #inner1 {
        height: 300px;
        width: 300px;
        background-color: #21759b;
        position: relative;
        left: 100px;
        top: 100px;
    }

    #inner2 {
        height: 150px;
        width: 150px;
        background-color: #791329;
        position: relative;
        left: 75px;
        top: 75px;
    }


</style>

<div id="outer">
    <div id='inner1'>
        <div id='inner2'></div>
    </div>
</div>


<script>

  (function () {


      Object.defineProperties(HTMLDocument.prototype, {
          myMouseEnterElement: {
            get: function () {
              return this._myMouseEnterElement || this.body;
            },
            set: function (el) {
              this._myMouseEnterElement && this._myMouseEnterElement.classList.remove("pseudo_my_mouseleave", "pseudo_my_mouseenter");
              // this.myMouseEnterElement = el;
              el.classList.add("pseudo_my_mouseenter");
            }
          },
          myMouseLeaveElement: {
            get: function () {
              return this._myActiveElement || this.body;
            },
            set: function (el) {
              this._myActiveElement && this._myActiveElement.classList.remove("pseudo_my_mouseenter", "pseudo_my_mouseleave");
              // this._myActiveElement = el;
              el.classList.add("pseudo_my_mouseleave");
            }
          }
        }
      );


      //When mouse is located on inner HTML element when page finished to load we must to dispatch `mouseenter` event on target and ALL their parents till #document. We need to iterate it in reverse order so that is why we need this function and not iterate it directly inside controller.
      function getParentsNodes(element) {
        // push a target as first element.
        let arr = [element];
        while (element.parentNode) {
          element = element.parentNode;
          arr.unshift(element)
        }
        return arr;
      }

      // create event and define its `relatedTarget` property, it is unnecessary to define target, because we define event on particular node, so `target` attribute value adds automatically. But in some cases `relatedTarget` can be null (when we move mouse to alert() ao devtools
      function getEvent(name, target, relatedTarget) {
        let ev = new MouseEvent("my-mouse" + name);
        Object.defineProperty(ev, "relatedTarget", {
            value: relatedTarget ? relatedTarget : null
          }
        );
        return ev;
      }

      const MouseEnterLeaveController = {
        target: undefined,
        mousemove: function (e) {
          if (MouseEnterLeaveController.target && MouseEnterLeaveController.target !== e.target) {
            let mouseEnterEvent = getEvent("enter", e.target, MouseEnterLeaveController.target);
            let mouseLeaveEvent = getEvent("leave", MouseEnterLeaveController.target, e.target);

            //means that mouse moves towards child element. It can starts from <html>
            if (MouseEnterLeaveController.target.firstElementChild === e.target || MouseEnterLeaveController.target === document.documentElement) {
              document.myMouseEnterElement = e.target;
              e.target.dispatchEvent(mouseEnterEvent);

            }
            //means that mouse moves towards parent element
            else if (MouseEnterLeaveController.target.parentNode === e.target || getParentsNodes(e.target).length) {
              document.myMouseLeaveElement = e.target;
              MouseEnterLeaveController.target.dispatchEvent(mouseLeaveEvent);
            }
          }
            // hate this part of the code bu we must to implement this feature
          //  it must dispatch event on each element of the hierarchy,
          else if (!MouseEnterLeaveController.target) {
            for (let parent of getParentsNodes(e.target)) {
              let mouseEnterBubbleEvent = getEvent("enter", parent, undefined);
              parent.dispatchEvent(mouseEnterBubbleEvent)
            }
          }
          MouseEnterLeaveController.target = e.target;
        },

        mouseout: function (e) {
          //means that mouse is out of window
          if (!e.toElement) {
            let mouseLeaveEvent = new MouseEvent("my-mouseleave");
            setTimeout(() => {
              e.target.dispatchEvent(mouseLeaveEvent);
              MouseEnterLeaveController.target = null;
            }, 0)
          }
        }
      };


      window.addEventListener("mousemove", MouseEnterLeaveController.mousemove);
      // to detect whether mouse has been moved outside the window (to devtools for example)
      window.addEventListener("mouseout", MouseEnterLeaveController.mouseout);


      function log(type, target, relatedTarget) {
        console.log(type, "event:  cursor has been moved from ", relatedTarget, " to ", target);
      }

      function warn(type, target, relatedTarget) {
        console.warn(type, "event:  cursor has been moved from ", relatedTarget, " to ", target);
      }

      document.querySelector('#outer').addEventListener("mouseenter", e => log(e.type, e.target, e.relatedTarget));
      document.querySelector('#outer').addEventListener("mouseleave", e => log(e.type, e.target, e.relatedTarget));
      document.querySelector('#outer').addEventListener("my-mouseenter", e => warn(e.type, e.target, e.relatedTarget));
      document.querySelector('#outer').addEventListener("my-mouseleave", e => warn(e.type, e.target, e.relatedTarget));


      document.querySelector('#inner1').addEventListener("mouseenter", e => log(e.type, e.target, e.relatedTarget));
      document.querySelector('#inner1').addEventListener("mouseleave", e => log(e.type, e.target, e.relatedTarget));
      document.querySelector('#inner1').addEventListener("my-mouseenter", e => warn(e.type, e.target, e.relatedTarget));
      document.querySelector('#inner1').addEventListener("my-mouseleave", e => warn(e.type, e.target, e.relatedTarget));


      document.querySelector('#inner2').addEventListener("mouseenter", e => log(e.type, e.target, e.relatedTarget));
      document.querySelector('#inner2').addEventListener("mouseleave", e => log(e.type, e.target, e.relatedTarget));
      document.querySelector('#inner2').addEventListener("my-mouseenter", e => warn(e.type, e.target, e.relatedTarget));
      document.querySelector('#inner2').addEventListener("my-mouseleave", e => warn(e.type, e.target, e.relatedTarget));


      document.documentElement.addEventListener("mouseenter", e => log(e.type, e.target, e.relatedTarget));
      document.addEventListener("mouseenter", e => log(e.type, e.target, e.relatedTarget));

      document.documentElement.addEventListener("my-mouseenter", e => warn(e.type, e.target, e.relatedTarget));
      document.addEventListener("my-mouseenter", e => warn(e.type, e.target, e.relatedTarget));
      window.addEventListener("mouseleave", e => log(e.type, e.target, e.relatedTarget));
      window.addEventListener("my-mouseleave", e => log(e.type, e.target, e.relatedTarget));
    }

  )
  ();
</script>


